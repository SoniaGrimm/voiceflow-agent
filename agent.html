<script type="text/javascript">
  // 1) Lire les param√®tres d'URL
  const qs = new URLSearchParams(window.location.search);
  const targetFlow = qs.get('agent')   || '1';      // num√©ro de flow
  const email      = qs.get('email')   || 'guest@example.com';
  const prenom     = qs.get('prenom')  || '';
  const age        = qs.get('age')     || '';
  const sexe       = qs.get('sexe')    || '';

  console.log("[VF] Param√®tres:", { targetFlow, email, prenom, age, sexe });

  // 2) Charger le SDK V3
  (function (d, t) {
    const v = d.createElement(t), s = d.getElementsByTagName(t)[0];
    v.onload = function () {
      window.voiceflow.chat.load({
        verify:   { projectID: '68a6e2cc67f49328386b3766' }, 
        url:      'https://general-runtime.voiceflow.com',
        versionID:'production',
        userID:   email,   // identifiant utilisateur
        render: {
          mode: 'embedded',
          target: document.getElementById('vf-chat')
        },
        assistant: {
          name: "TAO",
          title: "TAO",
          description: "Bienvenue !",
          color: "#8B42A2",
          image: "https://cm4-production-assets.s3.amazonaws.com/1730303517127-cute-wolf.jpg"
        },
        // üîë IMPORTANT : passer les variables qui existent dans Voiceflow
        launch: {
          event: {
            type: 'launch',
            payload: {
              target_flow: targetFlow,
              email: email,
              prenom: prenom,
              age: age,
              sexe: sexe
            }
          }
        }
      }).then(() => {
        console.log("‚úÖ Webchat V3 charg√© (payload envoy√© au launch)");
      });
    };
    v.src  = 'https://cdn.voiceflow.com/widget-next/bundle.mjs';
    v.type = 'text/javascript';
    s.parentNode.insertBefore(v, s);
  })(document, 'script');
</script>
