<script type="text/javascript">
  // Lire les paramètres de l’URL
  const qs = new URLSearchParams(window.location.search);

  const email      = qs.get('email')       || 'guest@example.com';
  const prenom     = qs.get('prenom')      || '';
  const age        = qs.get('age')         || '';
  const sexe       = qs.get('sexe')        || '';
  const targetFlow = qs.get('target_flow') || '';

  console.log("[VF] Params:", { email, prenom, age, sexe, targetFlow });

  // Charger le SDK V3
  (function (d, t) {
    const v = d.createElement(t), s = d.getElementsByTagName(t)[0];
    v.onload = function () {
      window.voiceflow.chat.load({
        verify:   { projectID: '68a6e2cc67f49328386b3766' },
        url:      'https://general-runtime.voiceflow.com',
        versionID:'production',
        userID:   email,
        render: {
          mode: 'embedded',
          target: document.getElementById('vf-chat')
        },
        assistant: {
          name: "TAO",
          title: "TAO",
          description: "Bienvenue !",
          color: "#8B42A2",
          image: "https://cm4-production-assets.s3.amazonaws.com/1730303517127-cute-wolf.jpg"
        },
        launch: {
          event: {
            type: 'launch',
            payload: {
              email: email,
              prenom: prenom,
              age: age,
              sexe: sexe,
              target_flow: targetFlow
            }
          }
        }
      }).then(() => {
        console.log("✅ Webchat V3 chargé (payload envoyé).");
      });
    };
    v.src  = 'https://cdn.voiceflow.com/widget-next/bundle.mjs';
    v.type = 'text/javascript';
    s.parentNode.insertBefore(v, s);
  })(document, 'script');
</script>
